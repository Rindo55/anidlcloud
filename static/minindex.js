const form=document.getElementById("upload-form"),fileInput=document.getElementById("file-input"),urlInput=document.getElementById("url-input"),progressBar=document.getElementById("progressor"),vfile=document.getElementById("vfile"),vtime=document.getElementById("vtime"),vprog=document.getElementById("vprog"),vspeed=document.getElementById("vspeed"),udiv1=document.getElementById("udiv-main"),udiv2=document.getElementById("udiv2-main"),hstatus=document.getElementById("hstatus");function formatBytes(e,t=2){if(!+e)return"0 Bytes";let n=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,n)).toFixed(t<0?0:t))} ${["Bytes","KB","MB","GB"][n]}`}function formatTime(e){let t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),l=Math.floor(e-3600*t-60*n),r="";return t>0?(r+=t+"hour ",n>0&&(r+=n+"min ")):n>0?(r+=n+"min ",l>0&&(r+=l+"sec")):r+=l+"sec",r}function FileUploader(e){udiv1.style.display="none",udiv2.style.display="flex",vfile.innerHTML=e.name,vtime.innerHTML="Calculating...",vprog.innerHTML="0%",vspeed.innerHTML="Calculating...";let t=0,n=new Date().getTime(),l=0,r=new FormData;r.append("file",e),r.append("Connection","keep-alive");let i=new XMLHttpRequest;i.open("POST","/upload",!0),i.send(r),i.upload.onprogress=e=>{if(e.lengthComputable){let r=new Date().getTime();if(r-n>1e3){n=r,l=e.loaded-t,tRemaining=formatTime((e.total-e.loaded)/l),l=formatBytes(l).toString()+"/s";let i=Math.round(e.loaded/e.total*100);progressBar.style.width=`${i}%`,vprog.innerHTML=formatBytes(e.loaded)+"/"+formatBytes(e.total)+" | "+i+"%",vtime.innerHTML=tRemaining,vspeed.innerHTML=l,t=e.loaded}}},i.onerror=e=>{alert("Error! Upload failed. Can't connect to server."),udiv1.style.display="flex",udiv2.style.display="none"},i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE){let e=i.responseText;TgFileUploader(e)}}}function TgFileUploader(e){hstatus.innerHTML="Processing...",udiv1.style.display="none",udiv2.style.display="flex";let t=!0;done=1;let n;function l(){if(t){{let r=new XMLHttpRequest;r.open("GET","/process/"+e,!0),r.send(null),r.onreadystatechange=function(){if(r.readyState==XMLHttpRequest.DONE){let l=r.responseText;(l=JSON.parse(l)).message&&(t=!1,window.location="/file/"+e);let i=l.current,o=l.total;n=(i-done)/5,tRemaining=formatTime((o-i)/n),n=formatBytes(n).toString()+"/s";let s=Math.round(i/o*100);progressBar.style.width=`${s}%`,vprog.innerHTML=formatBytes(i)+"/"+formatBytes(o)+" | "+s+"%",vtime.innerHTML=tRemaining,vspeed.innerHTML=n,done=i}if(4==r.readyState&&400==r.status){t=!1,alert("Error! Upload failed. Can't connect to server."),udiv1.style.display="flex",udiv2.style.display="none";return}}}setTimeout(l,5e3)}}setTimeout(l,5e3)}function RemoteUploader(e){let t=new XMLHttpRequest;t.open("POST","/remote_upload",!0),t.setRequestHeader("url",e),t.send(null),t.onreadystatechange=function(){if(t.readyState==XMLHttpRequest.DONE){hstatus.innerHTML="Uploading...";let e=t.responseText;vfile.innerHTML=e+".temp",udiv1.style.display="none",udiv2.style.display="flex";let n=!0;function l(){if(n){{let t=new XMLHttpRequest;t.open("GET","/remote_status/"+e,!0),t.send(null),t.onreadystatechange=function(){if(t.readyState==XMLHttpRequest.DONE){let l=t.responseText;if("complete"==(l=JSON.parse(l)).message){n=!1,TgFileUploader(e);return}if(l.message){n=!1,alert(l.message),udiv1.style.display="flex",udiv2.style.display="none";return}let r=l.current,i=l.total;speed=(r-done)/5,tRemaining=formatTime((i-r)/speed),speed=formatBytes(speed).toString()+"/s";let o=Math.round(r/i*100);progressBar.style.width=`${o}%`,vprog.innerHTML=formatBytes(r)+"/"+formatBytes(i)+" | "+o+"%",vtime.innerHTML=tRemaining,vspeed.innerHTML=speed,done=r}if(4==t.readyState&&400==t.status){n=!1,alert("Error! Upload failed. Can't connect to server."),udiv1.style.display="flex",udiv2.style.display="none";return}}}setTimeout(l,5e3)}}done=1,setTimeout(l,5e3)}}}form.addEventListener("submit",e=>{try{e.preventDefault();let t=fileInput.files[0],n=urlInput.value;if(t){if(t.size<10276044.8){alert("File size must be more than 10MB");return}if(t.size>2126008811.52){alert("File size must be less than 2GB");return}FileUploader(t)}else if(n)""!=n.trim()&&(console.log(n),n=n.trim(),RemoteUploader(n));else{alert("Select a File or enter a URL");return}}catch(l){alert(l),udiv1.style.display="flex",udiv2.style.display="none";return}});